# Issue #18: Blanket Bog Browse Page

**Started**: 2026-02-05 16:30
**Ended**: 2026-02-09
**Issue**: https://github.com/shotleybuilder/sertantai-legal/issues/18

## Scope

This session covers **Blanket Bog** (free tier) browse page implementation only. Future tier and view sidebar work has been extracted to `.claude/plans/issue-18-future-tiers-and-views.md`.

## Completed

- [x] Browse layout (`/browse`) with emerald green accent, "Blanket Bog" tier badge
- [x] Read-only table via ElectricSQL + TableKit (no editing features)
- [x] 5 default views: Recent Laws, By Family, By Status, By Type, Geographic Scope
- [x] `defaultGrouping` / `defaultExpanded` via `svelte-table-kit@0.13.0`
- [x] DB-backed derived columns (`md_date_year`, `md_date_month`) for grouping
- [x] ViewSidebar from `svelte-table-views-sidebar` (basic integration)
- [x] ElectricSQL sync bug fixes (dropped columns, `columns` type mismatch after client upgrade)
- [x] `is_after` / `is_before` filter operators in `buildWhereFromFilters`
- [x] Stale shape recovery after Electric restart (onError handler, `ELECTRIC_ENABLE_INTEGRATION_TESTING`)
- [x] Startup script updated to manage Electric container with health polling

## Remaining Bugs / Work

1. [x] **Sidebar views & labelling** — Added 3 view groups (New Laws, Amended Laws, Repealed Laws) with 7 time-based views each, plus Classification group. Views ordered by definition. Commit `3b24a67`.
2. [x] **Grouping rows show Family column value** — Fixed in `svelte-table-kit` 0.13.2. Non-grouped columns on group header rows were hitting the `getIsAggregated()` branch (which renders via `slot="cell"`). Fix: moved `row.getIsGrouped()` check before `getIsAggregated()` so non-grouped cells render empty. Library commits `670d6ee`, `479ce3e`. Project updated in `dd2b43c`.
3. [x] **No search** — Researched and created #19. Extend `svelte-table-kit` with global search via TanStack Table's built-in `globalFilterFn` / `setGlobalFilter()`. Client-side, instant, works alongside column filters. To be implemented in a separate session.
4. [x] **`captureCurrentConfig()` returns hardcoded defaults** — Fixed to read actual view state (`viewFilters`, `viewSort`, `viewColumns`, `viewColumnOrder`, `viewGrouping`) instead of hardcoded defaults. Commit `3092b7b`.
5. [x] **`leg_gov_uk_url` link click area too small** — Made the `<a>` element fill the entire cell with `flex w-full h-full`. Commit `958095c`.
6. [x] **Mobile responsive** — Sidebar hidden below `lg` breakpoint, replaced with hamburger toggle that opens it as a fixed overlay with backdrop. Selecting a view auto-closes. Commit `0067d10`.
7. [x] **Title column truncation** — Removed `truncate max-w-xs` from title_en cell rendering. Users can resize columns to control visible width. Commit `b963aaa`.

See `.claude/plans/browse-page.md` for full bug details.

## Key Commits

| Commit | Description |
|--------|-------------|
| `c94b97e` | feat(ui): Add defaultGrouping to browse views |
| `a9239fc` | feat(ui): Add Blanket Bog read-only browse page |
| `17fd7d1` | fix(electric): Fix ElectricSQL sync failures and browse page data loading |
| `fc7c7e5` | feat(browse): Add ViewSidebar from svelte-table-views-sidebar |
| `4610f75` | fix: Pass WHERE clause to getUkLrtCollection |
| `3249826` | fix(electric): Handle stale shapes after Electric restart |

## Related Plans

- **Blanket Bog bugs/status**: `.claude/plans/browse-page.md`
- **Future tiers + view sidebar**: `.claude/plans/issue-18-future-tiers-and-views.md`
